=== Plugin Name ===
Contributors: ohtan
Tags: comments, spam, admin
Requires at least: 3.0.0
Tested up to: 3.3.2
Stable tag: 2.1.0
License: GPLv2
License URI: http://www.gnu.org/licenses/gpl-2.0.html

コメントスパム対策用プラグイン

== Description ==

### ■注意
####本スクリプトはマルチバイト文字列関数(mbstring)が必要となります

####2.0.xから2.1.0へアップグレードする場合
* 既にアップロードしているconfig.phpがそのまま利用できます

####1.xから2.1.0へアップグレードする場合
* 互換性がないので既にアップロードしているconfig.phpは利用できません

### ■特徴
以下の機能を自由に組み合わせることにより、閾値に達した投稿を制限することができます

1. ひらがなが含まれているか？
2. 日本語(2バイト以上の文字)が含まれているか？
3. 1行の文字数がN文字を超えていないか？
4. 連続した改行の合計がN個を超えていないか？
5. URLが含まれているか？
6. NGワードが含まれているか？
7. URLがURIBLデータベースに登録されているか？
8. 投稿者のIPがDNSBLデータベースに登録されているか？

※DNSBL、URIBLの検査はDNSを参照するため、投稿時のパフォーマンスが低下する場合があります

== Installation ==

### ■プラグインの有効化
管理ページ＞プラグイン＞spam-bye2を有効にしてください

### ■設定
管理ページ＞設定＞SPAM-BYE2設定にて下記を設定してください

### 基本設定
####1.スパムと判定する閾値
* この値に達すると2で指定したアクションを実行します

####2.スパムと判定された場合のアクション
* 「メッセージを表示」は3に指定したメッセージを表示します
* 「指定したURLにリダイレクト」は4に指定したURLにリダイレクトします

####3.スパムと判定された場合に表示するメッセージ
* 2が「指定したメッセージを表示」にしている場合はこのメッセージを表示します

####4.スパムと判定された場合のリダイレクトURL
* 2が「指定したURLにリダイレクト」にしている場合はこのURLにリダイレクトします

####5.DNSBLデータベース
* 投稿者のIPアドレスを検査するブラックリストデータベースを指定します
* 複数のブラックリストデータベースを指定する場合は1件毎に改行を入れてください

####6.URIBLデータベース
* 投稿されたURLに含まれるホスト名を検査するブラックリストデータベースを指定します
* 複数のブラックリストデータベースを指定する場合は1件毎に改行を入れてください

### チェック項目設定
####1.優先度
* 上位から下位の順番に検査します

####2.チェック内容
下記の中から選択します

* ひらがなが含まれているか？
* 日本語(2バイト以上の文字)が含まれているか？
* 1行の文字数がN文字を超えていないか？
* 連続した改行の合計がN個を超えていないか？
* URLが含まれているか？
* NGワードが含まれているか？
* URLがURIBLデータベースに登録されているか？
* 投稿者のIPがDNSBLデータベースに登録されているか？

####3.チェック対象
下記の中から選択します

* 名前欄
* url欄
* コメント欄

####4.値
[ひらがなが含まれているか？]

* チェック対象にひらがなが含まれてない場合にポイントが加算されます

#### 
        例)
        加算するポイント=20
        ※コメント欄にひらがなが含まれていない場合は20ポイントとなります

[日本語(2バイト以上の文字)が含まれているか？]

* チェック対象に日本語(2バイト以上の文字)が含まれてない場合にポイントが加算されます

#### 
        例)
        加算するポイント=20
        ※コメント欄に日本語(2バイト以上の文字)が含まれていない場合は20ポイントとなります

[1行の文字数がN文字を超えていないか？]

* チェック対象の1行あたりの文字数が許容文字数を超過した場合にポイントが加算されます
* 許容文字数を超過する行が複数あった場合は該当する行数分ポイントが加算されます
* 但し加算ポイントの最大値が0以外の場合はその値が最大値になります

#### 
        例)
        チェック対象=コメント欄
        加算するポイント=20
        加算ポイントの最大値=0
        許容文字数=200
        ※コメント欄に200文字を超過する行が5箇所存在していた場合は20x5=100ポイントとなります

        チェック対象=コメント欄
        加算するポイント=20
        加算ポイントの最大値=60
        許容文字数=200
        ※コメント欄に200文字を超過する行が5箇所存在していた場合(20x5=100)でも60ポイントとなります

[連続した改行の合計がN個を超えていないか？]

* チェック対象の連続した改行(チェック改行数以上の箇所)の合計が許容改行数を超過した場合にポイントが加算されます

#### 
        例)
        チェック対象=コメント欄
        加算するポイント=20
        チェック改行数=40
        許容改行数=12
        ※コメント欄に4個以上の連続した改行が存在しその改行数の合計が12を超過している場合は20ポイントとなります

[URLが含まれているか？]

* チェック対象に含まれるURL数に応じてポイントが加算されます
* 但し加算ポイントの最大値が0以外の場合はその値が最大値になります
* チェックした結果のURL数が許容URL数以下だった場合はポイントは加算されません

#### 
        例)
        チェック対象=コメント欄
        加算するポイント=20
        加算ポイントの最大値=0
        許容URL数=0
        ※コメント欄にURLが5個存在していた場合は20x5=100ポイントとなります

        チェック対象=コメント欄
        加算するポイント=20
        加算ポイントの最大値=50
        許容URL数=0
        ※コメント欄にURLが5個存在していた場合(20x5=100)でも50ポイントとなります

        チェック対象=コメント欄
        加算するポイント=20
        加算ポイントの最大値=0
        許容URL数=5
        ※コメント欄にURLが5個存在していた場合(20x5=100)でも0ポイントとなります


[NGワードが含まれているか？]

* チェック対象にSB2_NGWORD_番号のNGワードにマッチした数に応じてポイントが加算されます
* 但し加算ポイントの最大値が0以外の場合はその値が最大値になります

#### 
        例)
        チェック対象=コメント欄
        加算するポイント=40
        加算ポイントの最大値=0
        NGワード=NGワード1[改行]NGワード2[改行]NGワード3
        ※コメント欄にNGワードが2個存在していた場合は40x2=80ポイントとなります

        チェック対象=コメント欄
        加算するポイント=40
        加算ポイントの最大値=80
        NGワード=NGワード1[改行]NGワード2[改行]NGワード3
        ※コメント欄にNGワードが3個存在していた場合(40x3=120)でも80ポイントとなります

[URLがURIBLデータベースに登録されているか？]

* URIBLデータベースが複数指定されている場合、全てのデータベースを参照し登録されていた数だけポイントが加算されます
* 但し加算ポイントの最大値が0以外の場合はその値が最大値になります

#### 
        例)
        チェック対象=コメント欄
        加算するポイント=20
        加算ポイントの最大値=0
        ※コメント欄のURLが3箇所のURIBLに登録されていた場合は20x3=60ポイントとなります

        チェック対象=コメント欄
        加算するポイント=20
        加算ポイントの最大値=40
        ※コメント欄のURLが3箇所のURIBLに登録されていた場合(20x3=60)でも40ポイントとなります

[投稿者のIPがDNSBLデータベースに登録されているか？]

* DNSBLデータベースが複数指定されている場合、全てのデータベースを参照し登録されていた数だけポイントが加算されます
* 但し加算ポイントの最大値が0以外の場合はその値が最大値になります

#### 
        例)
        加算するポイント=20
        加算ポイントの最大値=0
        ※投稿者のIPが3箇所のDNSBLに登録されていた場合は20x3=60ポイントとなります

        加算するポイント=20
        加算ポイントの最大値=40
        ※投稿者のIPが3箇所のDNSBLに登録されていた場合(20x3=60)でも40ポイントとなります

== Screenshots ==

/tags/2.1.0/screenshot-1.png

== Changelog ==

= 2.1.0 =
* 管理画面に設定用I/Fを追加

> update on 2012/05/25

= 2.0.4 =
* DNS参照部分のバグを修正

> update on 2012/04/29

= 2.0.3 =
* stable版をリリース

> update on 2011/08/27

= 2.0.1 =
* beta版を更新

> update on 2011/07/15

= 2.0.0 =
* beta版をリリース

> update on 2011/07/12

= 1.3.0 =
* 管理者がログインしている場合は検査対象から除外されるように変更

> update on 2011/01/18

= 1.2.0 =
* プラグインを有効にするだけで使えるように修正
* DNSDBLのデフォルトをdnsbl.spam-champuru.livedoor.comに変更

> update on 2008/09/20

= 1.1.0 =
* 名前欄を検査対象に追加
* ソースの文字コードをUTF8に変更
* 投稿URL数の検査方法を変更

> update on 2008/11/02

= 1.0.0 =
* 1stリリース

> update on 2007/08/12

== Upgrade Notice ==
####none


== Arbitrary section ==

####■See also(DNSBL/URIBL)
* スパムちゃんぷるー(dnsbl.spam-champuru.livedoor.com)

> http://spam-champuru.livedoor.com/dnsbl/

* Barracuda Reputation Block List(b.barracudacentral.org)

> http://www.barracudacentral.org/rbl

* RBL.JP(url.rbl.jp/dyndns.rbl.jp/notop.rbl.jp)

> http://www.rbl.jp/allrbl.html

* SURBL(multi.surbl.org)

> http://www.surbl.org/

* URIBL(multi.uribl.com)

> http://www.uribl.com/